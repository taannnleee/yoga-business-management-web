@startuml SendOTP
title Gá»­i OTP

actor Actor
boundary verifyPage
control AuthenticationController
entity userService
entity emailService

Database Database

Actor -> verifyPage: Request OTP
activate verifyPage
verifyPage -> AuthenticationController: sendOTPRequest()
activate AuthenticationController
AuthenticationController -> userService: findByEmail(email)
activate userService
userService -> Database: findByEmail(email)
activate Database

alt User is null
    Database --> userService: return null
    userService --> AuthenticationController: return null
    AuthenticationController --> verifyPage: Account not found

else User is not null
    Database --> userService: return user
    deactivate Database
    userService -> emailService: sendOTP(email, message, otp)
    activate emailService
    emailService -> Database: saveOTP(userID)
    deactivate emailService

    alt OTP sent successfully
    activate Database
        Database --> emailService: OTP saved
        deactivate Database
        activate emailService
        emailService --> userService: OTP sent successfully
        userService --> AuthenticationController: OTP sent successfully
        deactivate emailService

        AuthenticationController --> verifyPage: OTP sent successfully

    else OTP sending failed
    activate emailService
    Database --> emailService: OTP save failed
        emailService --> userService: OTP failed to send
        userService --> AuthenticationController: OTP failed to send
        deactivate emailService

        AuthenticationController --> verifyPage: OTP sending failed
        deactivate verifyPage
    end
end

deactivate userService
deactivate AuthenticationController
@enduml
